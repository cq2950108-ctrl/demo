# 飞书表格数据同步配置指南

本指南将帮助您配置飞书表格数据同步功能，实现自动从飞书表格获取业务数据。

## 前置条件

1. 拥有飞书企业账号
2. 有权限访问需要同步的飞书表格
3. 能够创建飞书企业自建应用

## 步骤一：创建飞书企业自建应用

### 1. 访问飞书开放平台

访问 [飞书开放平台](https://open.feishu.cn/) 并登录您的企业账号。

### 2. 创建应用

1. 点击「创建企业自建应用」
2. 填写应用信息：
   - 应用名称：个人效率管理系统
   - 应用描述：用于同步飞书表格数据的个人效率管理工具
   - 应用图标：可选择默认图标

### 3. 配置应用权限

在应用管理页面，进入「权限管理」：

1. 申请以下权限：
   - `sheets:read` - 查看电子表格
   - `drive:read` - 查看云文档

2. 等待管理员审批权限（如果您是管理员，可以直接通过）

### 4. 配置安全设置

在「安全设置」中添加重定向URL：

- 开发环境：`http://localhost:3000/feishu-callback`
- 生产环境：`https://yourdomain.com/feishu-callback`

### 5. 获取应用凭证

在应用详情页面记录以下信息：
- **App ID**（客户端ID）
- **App Secret**（客户端密钥）

## 步骤二：配置应用环境变量

### 1. 创建环境变量文件

在项目根目录创建 `.env.local` 文件：

```bash
cp .env.example .env.local
```

### 2. 填写飞书应用配置

编辑 `.env.local` 文件，填入您的飞书应用信息：

```env
# 飞书应用的 App ID
VITE_FEISHU_CLIENT_ID=cli_your_actual_app_id_here

# 飞书应用的 App Secret  
VITE_FEISHU_CLIENT_SECRET=your_actual_app_secret_here
```

⚠️ **安全提醒**：
- 不要将 `.env.local` 文件提交到版本控制系统
- App Secret 是敏感信息，请妥善保管

## 步骤三：准备飞书表格数据

### 1. 表格格式要求

您的飞书表格应该包含以下列（第一行为标题行）：

| 列位置 | 列名 | 数据类型 | 说明 |
|--------|------|----------|------|
| A | 日期 | 日期 | 格式：YYYY-MM-DD |
| B | 成交数量 | 数字 | 当日成交订单数量 |
| C | 成交金额 | 数字 | 当日成交总金额 |
| D | 转化成本 | 数字 | 当日广告投入成本 |
| E | 曝光量 | 数字 | 当日广告曝光次数 |
| F | 转化率 | 数字 | 当日转化率（百分比） |

### 2. 示例数据

```
日期        成交数量  成交金额   转化成本   曝光量    转化率
2024-01-15    25     12500.00   2300.00   15000    1.67
2024-01-16    30     15000.00   2800.00   18000    1.67
2024-01-17    22     11000.00   2100.00   14000    1.57
```

### 3. 获取表格链接

1. 打开您的飞书表格
2. 点击右上角「分享」按钮
3. 选择「获取链接」
4. 复制表格链接（格式类似：`https://xxx.feishu.cn/sheets/shtcnxxxxxx`）

## 步骤四：配置数据同步

### 1. 启动应用

```bash
npm run dev
```

### 2. 访问文档配置页面

在浏览器中访问：`http://localhost:3000/document-config`

### 3. 添加飞书表格配置

1. 点击「添加文档配置」
2. 填写配置信息：
   - **配置名称**：给配置起一个便于识别的名称
   - **文档类型**：选择「飞书表格」
   - **文档链接**：粘贴您的飞书表格链接
   - **数据范围**：例如 `A1:F1000`（可选，默认会自动检测）
   - **启用配置**：开启
   - **自动同步**：根据需要选择是否启用

### 4. 进行飞书授权

1. 在「访问令牌」字段旁，点击「飞书授权」按钮
2. 系统会打开飞书授权页面
3. 使用您的飞书账号登录并授权
4. 授权成功后，页面会显示「已授权」状态

### 5. 测试连接

1. 点击「测试连接」按钮
2. 如果配置正确，会显示「连接测试成功」
3. 如果失败，请检查：
   - 飞书应用配置是否正确
   - 表格链接是否有效
   - 是否有表格访问权限

### 6. 同步数据

1. 点击「同步数据」按钮
2. 系统会从飞书表格获取数据并导入到本地
3. 同步成功后会显示导入的记录数量

## 步骤五：使用数据

### 1. 查看导入的数据

访问「数据录入」页面，您可以看到从飞书表格同步的数据。

### 2. 数据分析

访问「数据分析」页面，查看基于同步数据生成的图表和分析报告。

### 3. 自动同步

如果启用了自动同步，系统会按照设定的间隔自动从飞书表格获取最新数据。

## 常见问题

### Q1: 授权失败怎么办？

**A1**: 请检查：
- 飞书应用的 App ID 和 App Secret 是否正确
- 重定向URL是否配置正确
- 应用权限是否已通过审批
- 网络连接是否正常

### Q2: 连接测试失败？

**A2**: 请确认：
- 表格链接格式是否正确
- 您是否有该表格的访问权限
- 表格是否设置了访问限制

### Q3: 数据同步不完整？

**A3**: 请检查：
- 表格数据格式是否符合要求
- 数据范围设置是否正确
- 表格中是否有空行或格式错误的数据

### Q4: 如何更新数据？

**A4**: 有两种方式：
- 手动同步：在文档配置页面点击「同步数据」
- 自动同步：启用自动同步功能，系统会定期更新

### Q5: 数据安全性如何保障？

**A5**: 
- 所有数据存储在本地浏览器中
- 飞书授权令牌加密存储
- 不会上传您的业务数据到第三方服务器

## 技术支持

如果您在配置过程中遇到问题，可以：

1. 查看浏览器开发者工具的控制台错误信息
2. 检查网络请求是否正常
3. 确认飞书应用配置和权限设置

## 更新日志

- **v1.0.0** - 初始版本，支持飞书表格OAuth2.0授权和数据同步